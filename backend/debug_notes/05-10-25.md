# Debug notes
2025-10-05 23:02

## Errors

### LLM response not JSON-parsable

After performing all `disclosure_inference` queries to LLM, `disclosure_inference:_analyze_single_metric` fails to parse LLM JSON response.

```
| ERROR    | esg_encoding.disclosure_inference:_analyze_single_metric:271 - Failed to parse LLM JSON response for metric Description of approach to informing 
customers about products and services: Expecting value: line 1 column 1 (char 0)
```

And chained error
```
| ERROR    | esg_encoding.api:upload_report:300 - Error in assessment processing: LLM returned invalid JSON format: Expecting value: line 1 column 1 (char 0)
```

Which should be caused by the line

```py
llm_result = json.loads(response.choices[0].message.content)
```

**Solution**

Added `response_format={"type": "json_object"}` to query in `self.llm_clent.chat.completion.create(...)` from `disclosure_inference:_analyze_single_metric`.

**Effects**

Compliance reports are now viewable, as well as metrics on chat menu.

### Messages delay in disappearances after sending in chatbot

As described

**Solution**

Removed `await` from `onSendMessage` in `ChatInterface:handeSendMessage`.

**Effects**

Bug fixed

### Chat page errors out and go blank when refreshing



### Failed to create enhanced knowledge base

| ERROR    | esg_encoding.api:_create_enhanced_knowledge_base:810 - Failed to create enhanced knowledge base: 2 validation errors for ReportContent
document_content
  Field required [type=missing, input_value={'document_id': 'enhanced..., 'total_segments': 516}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing
embeddings
  Field required [type=missing, input_value={'document_id': 'enhanced..., 'total_segments': 516}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing





